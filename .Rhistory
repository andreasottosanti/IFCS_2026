labs(y = expression(mu))+
scale_fill_manual(values = c("0" = "black", "1" = "lightgrey")) +
theme( axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
perla_draws$Contains_zero <- factor(as.numeric(perla_draws$leftHPD < 0 & perla_draws$rightHPD > 0))
ggplot(perla_draws, aes(x = Gene, y = Value, color = Contains_zero))+
geom_boxplot()+theme_bw()+
facet_wrap(~Cluster, nrow = 3)+
geom_abline(intercept = 0, slope = 0, lty = 2)+
labs(y = expression(mu))+
scale_fill_manual(values = c("0" = "black", "1" = "lightgrey")) +
theme( axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
ggplot(perla_draws, aes(x = Gene, y = Value, color = Contains_zero))+
geom_boxplot()+theme_bw()+
facet_wrap(~Cluster, nrow = 3)+
geom_abline(intercept = 0, slope = 0, lty = 2)+
labs(y = expression(mu))+
scale_color_manual(values = c("0" = "black", "1" = "lightgrey")) +
theme( axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
ggplot(perla_draws, aes(x = Gene, y = Value, color = Contains_zero))+
geom_boxplot()+theme_bw()+
facet_wrap(~Cluster, nrow = 3)+
geom_abline(intercept = 0, slope = 0, lty = 2)+
labs(y = expression(mu))+
scale_color_manual(values = c("0" = "black", "1" = "grey")) +
theme( axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
ggplot(perla_draws, aes(x = Gene, y = Value, color = Contains_zero))+
geom_boxplot()+theme_bw()+
facet_wrap(~Cluster, nrow = 3)+
geom_abline(intercept = 0, slope = 0, lty = 2)+
labs(y = expression(mu))+
scale_color_manual(values = c("0" = "black", "1" = "grey")) +
theme( axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1), legend.position = "none")
ggsave("SVgenes_logcounts_posterior.pdf", width = 9, height = 7)
ggsave("Images/SVgenes_logcounts_posterior.pdf", width = 9, height = 7)
# computing the HPD intervals
hpd <- apply(res$Mu, c(1,2), function(y) HPDinterval(mcmc(y), prob = .99))
# preparing the ggplot
perla_draws <- res$Mu
dimnames(perla_draws) <- list(
Cluster = factor(1:dim(perla_draws)[1]),
Gene = colnames(selected),
Iteration = 1:dim(perla_draws)[3])
perla_draws <- as.data.frame.table(perla_draws)
colnames(perla_draws)[colnames(perla_draws) == "Freq"] <- "Value"
levels(perla_draws$Cluster) <- paste("Cluster", levels(perla_draws$Cluster))
perla_draws <- cbind(perla_draws,
leftHPD = rep(as.vector(hpd[1,,]), dim(res$Mu)[3]),
rightHPD = rep(as.vector(hpd[2,,]), dim(res$Mu)[3]))
perla_draws$Contains_zero <- factor(as.numeric(perla_draws$leftHPD < 0 & perla_draws$rightHPD > 0))
ggplot(perla_draws, aes(x = Gene, y = Value, color = Contains_zero))+
geom_boxplot()+theme_bw()+
facet_wrap(~Cluster, nrow = 3)+
geom_abline(intercept = 0, slope = 0, lty = 2)+
labs(y = expression(mu))+
scale_color_manual(values = c("0" = "black", "1" = "grey")) +
theme( axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1), legend.position = "none")
ggsave("Images/SVgenes_logcounts_posterior.pdf", width = 9, height = 7)
rm(list = ls())
library(perla)
library(spatialDE) # it contains the data
library(SpatialExperiment) # to organize the data into a SpatialExperiment object
library(nnSVG)
library(scran)
library(scry)
library(ggplot2)
library(mclust)
set.seed(123)
# data collection ---------------------------------------------------------
count_matrix <- read.csv("Data/Rep11_MOB_0.csv", header = T, row.names = 1)
coordinates <- read.csv("Data/MOB_sample_info.csv", header = T, row.names = 1)
summary(coordinates)
rm(list = ls())
x <- readRDS("processed_data.RDS")
W <- readRDS("proximity_matrix.RDS")
rowSums(W)
summary(rowSums(W))
x$sample_id
x[["Apoe"]]
rowData(x)
grid.points(spots$x_img, -spots$y_img, pch=19, gp=gpar(col=logcounts(x)[rowData(x)$gene_names == "Apoe",]), size = unit(1.5, "char"))
img <- readPNG(source = "Images/tissue.png")
grid::grid.raster(img)
img_height <- dim(img)[1]+400
img_width  <- dim(img)[2]+640
spots <- as.data.frame(spatialCoords(x))
colnames(spots) <- c("x","y")
spots$x_img <- (spots$x - min(spots$x)) / (max(spots$x) - min(spots$x)) * img_width +220
spots$y_img <- img_height - ((spots$y - min(spots$y)) / (max(spots$y) - min(spots$y)) * img_height)-850
perla_viridis <- viridis::viridis(length(unique(colData(x)$perla)))[as.numeric(factor(colData(x)$perla))]
km_viridis <- viridis::viridis(length(unique(colData(x)$km)))[as.numeric(factor(colData(x)$km))]
gmm_viridis <- viridis::viridis(length(unique(colData(x)$gmm)))[as.numeric(factor(colData(x)$gmm))]
ggplot()+theme_minimal()
grid.raster(img)
grid.points(spots$x_img, -spots$y_img, pch=19, gp=gpar(col=perla_viridis), size = unit(1.5, "char"))
perla_viridis
viridis::viridis(length(unique(colData(x)$perla)))[as.numeric(factor(colData(x)$perla))]
unique(colData(x)$perla)
colData(x)
rm("x")
perlaRun_SVgenes_logcounts <- readRDS("~/perla_to_mouse_brain/Results/perlaRun_SVgenes_logcounts.RDS")
x <- readRDS("~/perla_to_mouse_brain/Results/perlaRun_SVgenes_logcounts.RDS")
dim(x)
colData(x)
class(x)
x <- readRDS("~/perla_to_mouse_brain/Results/SVgenes_logcounts.RDS")
class(x)
colData(x)
colData(x)$perla
perla_viridis <- viridis::viridis(length(unique(colData(x)$perla)))[as.numeric(factor(colData(x)$perla))]
km_viridis <- viridis::viridis(length(unique(colData(x)$km)))[as.numeric(factor(colData(x)$km))]
gmm_viridis <- viridis::viridis(length(unique(colData(x)$gmm)))[as.numeric(factor(colData(x)$gmm))]
ggplot()+theme_minimal()
grid.raster(img)
grid.points(spots$x_img, -spots$y_img, pch=19, gp=gpar(col=perla_viridis), size = unit(1.5, "char"))
# plot of some genes
# Apoe
ggplot()+theme_minimal()
grid.raster(img)
grid.points(spots$x_img, -spots$y_img, pch=19, gp=gpar(col=logcounts(x)[rowData(x)$gene_names == "Apoe",]), size = unit(1.5, "char"))
logcounts(x)[rowData(x)$gene_names == "Apoe",]
grid.points(spots$x_img, -spots$y_img, pch=19, gp=gpar(fill=logcounts(x)[rowData(x)$gene_names == "Apoe",]), size = unit(1.5, "char"))
grid.points(spots$x_img, -spots$y_img, pch=19, gp=gpar(col=logcounts(x)[rowData(x)$gene_names == "Apoe",]), size = unit(1.5, "char"))
# plot of some genes
# Apoe
vals <- logcounts(x)[rowData(x)$gene_names == "Apoe", ]
vals
pal <- colorRampPalette(c("blue", "white", "red"))
cols <- pal(100)
col_vals <- cols[cut(vals, breaks = 100, include.lowest = TRUE)]
grid.points(spots$x_img, -spots$y_img, pch=19, gp=gpar(col=col_vals), size = unit(1.5, "char"))
library(grid)
cb <- colorbarGrob(
cols,
at = seq(0, 1, length.out = 5),
labels = round(seq(min(vals), max(vals), length.out = 5), 2),
gp = gpar(col = NA),
legend_gp = gpar(col = NA),
name = "Apoe"
)
vals
summary(vals)
library(grid)
cb_raster <- as.raster(matrix(cols, ncol = 1))
pushViewport(viewport(
x = unit(0.92, "npc"),
y = unit(0.5, "npc"),
width = unit(0.03, "npc"),
height = unit(0.6, "npc"),
just = "centre"
))
# Geni di interesse
genes <- c("Apoe", "S110a5", "Kctd12", "Sash1")
# Estrai l’espressione dal dataset
expr_mat <- spots[, genes]
# Estrai l’espressione dal dataset
expr_mat <- logcounts(x)[rowData(x)$gene_names %in% genes,]
expr_mat
# Calcola intervallo globale tra tutti e 4 i geni
global_range <- range(expr_mat, na.rm = TRUE)
global_range
library(viridis)
n_col <- 100  # quanti colori nella scala
col_vals <- viridis(n_col)  # palette viridis
expr_bins <- seq(global_range[1], global_range[2], length.out = n_col)
expr_bins
map_to_colors <- function(expr_vector) {
col_vals[findInterval(expr_vector, expr_bins, all.inside = TRUE)]
}
grid.newpage()
pushViewport(viewport(layout = grid.layout(2, 2)))  # 2 righe x 2 colonne
# plot of some genes
genes <- c("Apoe", "S110a5", "Kctd12", "Sash1")
vals <- logcounts(x)[rowData(x)$gene_names %in% genes, ]
vals
# plot of some genes
genes <- c("Apoe", "S100a5", "Kctd12", "Sash1")
vals <- logcounts(x)[rowData(x)$gene_names %in% genes, ]
vals
rownames(vals)
ncol(x)
rep(rownames(vals), ncol(x))
vals_frame <- data.frame(values = as.vector(vals),
gene_names = rep(rownames(vals), ncol(x)))
spots$x_img
vals_frame <- data.frame(values = as.vector(vals),
gene_names = rep(rownames(vals), ncol(x)),
x = rep(spots$x, each = length(genes)),
y = rep(spots$y, each = length(genes)))
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_bw()+
facet_wrap(~gene_names)
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts")
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts")+
theme(legend.position = "bottom")
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts")+
theme(legend.position = "bottom", x = "", y = "")
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts")+
theme(legend.position = "bottom", x = NULL, y = NULL)
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts")+
theme(legend.position = "bottom", x = NULL, y = NA)
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts")+
theme(legend.position = "bottom", x = " ", y = " ")
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
theme(legend.position = "bottom")
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
theme(legend.position = "bottom")+ scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9"))
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
theme(legend.position = "bottom")+ scale_fill_continuous(values=c("#999999", "#E69F00", "#56B4E9"))
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
# theme(legend.position = "bottom")+ scale_fill_continuous(values=c("#999999", "#E69F00", "#56B4E9"))+
sp2+scale_color_gradient2(midpoint=mean(vals_frame$values), low="#999999", mid="#E69F00",
high="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
# theme(legend.position = "bottom")+ scale_fill_continuous(values=c("#999999", "#E69F00", "#56B4E9"))+
+scale_color_gradient2(midpoint=mean(vals_frame$values), low="#999999", mid="#E69F00",
high="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
# theme(legend.position = "bottom")+ scale_fill_continuous(values=c("#999999", "#E69F00", "#56B4E9"))+
scale_color_gradient2(midpoint=mean(vals_frame$values), low="#999999", mid="#E69F00",
high="#56B4E9", space ="Lab" )
vals <- logcounts(x)[rowData(x)$gene_names %in% genes, ]
vals <- vals - mean(vals)
vals_frame <- data.frame(values = as.vector(vals),
gene_names = rep(rownames(vals), ncol(x)),
x = rep(spots$x, each = length(genes)),
y = rep(spots$y, each = length(genes)))
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
# theme(legend.position = "bottom")+ scale_fill_continuous(values=c("#999999", "#E69F00", "#56B4E9"))+
scale_color_gradient2(midpoint=mean(vals_frame$values), low="#999999", mid="#E69F00",
high="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+scale_color_gradient(low="blue", high="red")
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+#scale_color_gradient(low="blue", high="red")
# theme(legend.position = "bottom")+ scale_fill_continuous(values=c("#999999", "#E69F00", "#56B4E9"))+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
# theme(legend.position = "bottom")+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
theme(legend.position = "bottom")+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
# theme(legend.position = "bottom")+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
theme(text = element_text(size = 18))+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "logcounts", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "s", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 3)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggsave(filename = "Images/SVgenes_logcounts_gene_expressions.pdf", width = 9, height = 7)
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 4)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggsave(filename = "Images/SVgenes_logcounts_gene_expressions.pdf", width = 9, height = 7)
res <- readRDS("~/perla_to_mouse_brain/Results/perlaRun_SVgenes_logcounts.RDS")
res$Mu
dim(res$Mu)
source("~/perla_to_mouse_brain/Functions/dependencies.R")
Mu <- apply(res$Mu, c(1,2), function(y) MCMCglmm::posterior.mode(y))
res <- readRDS("~/perla_to_mouse_brain/Results/perlaRun_SVgenes_logcounts.RDS")
x <- readRDS("~/perla_to_mouse_brain/Results/SVgenes_logcounts.RDS")
# plot some genes (estimated)
genes <- c("Apoe", "S100a5", "Kctd12", "Sash1")
Mu <- apply(res$Mu, c(1,2), function(y) MCMCglmm::posterior.mode(y))
warnings()
Mu <- apply(res$Mu, c(1,2), function(y) MCMCglmm::posterior.mode(mcmc(y)))
Mu
dim(Mu)
vals <- apply(res$Mu, c(1,2), function(y) MCMCglmm::posterior.mode(mcmc(y)))
vals <- apply(res$Mu, c(1,2), function(y) MCMCglmm::posterior.mode(mcmc(y)))[,rowData(x)$gene_names %in% genes]
vals
colnames(vals) <- genes
vals
vals <- apply(res$Mu, c(1,2), function(y) mean(mcmc(y)))[,rowData(x)$gene_names %in% genes]
colnames(vals) <- genes
vals
gene_means <- apply(res$Mu, c(1,2), function(y) mean(mcmc(y)))[,rowData(x)$gene_names %in% genes]
colnames(gene_means) <- genes
colData(x)$perla
vals <- gene_means[colData(x)$perla,]
vals
vals <- t(gene_means[colData(x)$perla,])
vals_frame <- data.frame(values = as.vector(vals),
gene_names = rep(rownames(vals), ncol(x)),
x = rep(spots$x, each = length(genes)),
y = rep(spots$y, each = length(genes)))
vals
vals_frame <- data.frame(values = as.vector(vals),
gene_names = rep(rownames(vals), ncol(x)),
x = rep(spatialCoords(x)[,1], each = length(genes)),
y = rep(spatialCoords(x)[,2], each = length(genes)))
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 4)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggsave(filename = "Images/SVgenes_logcounts_gene_expressions.pdf", width = 9, height = 7)
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 4, colour = "black")+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 4, shape = 21, colour = "black")+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, col = values))+
geom_point(cex = 4, shape = 21)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_color_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggplot(vals_frame, aes(x = x, y = y, fill = values))+
geom_point(cex = 4, shape = 21)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_fill_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggsave(filename = "Images/SVgenes_logcounts_gene_expressions.pdf", width = 9, height = 7)
ggplot(vals_frame, aes(x = x, y = y, fill = values))+
geom_point(cex = 5, shape = 21)+theme_minimal()+
facet_wrap(~gene_names)+
labs(col = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_fill_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggsave(filename = "Images/SVgenes_logcounts_gene_expressions.pdf", width = 9, height = 7)
ggplot(vals_frame, aes(x = x, y = y, fill = values))+
geom_point(cex = 5, shape = 21)+theme_minimal()+
facet_wrap(~gene_names)+
labs(fill = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_fill_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
vals_frame <- data.frame(values = as.vector(vals),
gene_names = rep(rownames(vals), ncol(x)),
x = rep(spatialCoords(x)[,1], each = length(genes)),
y = -rep(spatialCoords(x)[,2], each = length(genes)))
ggplot(vals_frame, aes(x = x, y = y, fill = values))+
geom_point(cex = 5, shape = 21)+theme_minimal()+
facet_wrap(~gene_names)+
labs(fill = "", x = "", y = "")+
theme(text = element_text(size = 18), axis.text = element_blank())+
scale_fill_gradient2(midpoint=mean(vals_frame$values), mid="#999999", high="#E69F00",
low="#56B4E9", space ="Lab" )
ggsave(filename = "Images/SVgenes_logcounts_gene_expressions.pdf", width = 9, height = 7)
x <- readRDS("~/perla_to_mouse_brain/Results/SVgenes_logcounts.RDS")
dim(x)
# pca
values <- logcounts(x)
source("~/perla_to_mouse_brain/Functions/dependencies.R")
# pca
values <- logcounts(x)
x <- readRDS("~/perla_to_mouse_brain/Results/SVgenes_logcounts.RDS")
# pca
values <- logcounts(x)
values <- values - mean(values)
values
# pca
values <- logcounts(x)
values <- t(values - mean(values))
values
dim(values)
pc <- princomp(values)
pc$scores
pc <- data.frame(princomp(values)$scores[,1:2])
pc
pc <- data.frame(princomp(values)$scores[,1:2], z = colData(x)$perla)
names(pc) <- c("x","y","z")
ggplot(pc, aes(x,y,col = z))+geom_point()
reducedDim(x)
reducedDim(x)[,1:2]
pc <- data.frame(reducedDim(x)[,1:2], z = colData(x)$perla)
names(pc) <- c("x","y","z")
ggplot(pc, aes(x,y,col = z))+geom_point()
ggplot(pc, aes(x,y))+geom_point()
# pca
values <- logcounts(x)
values <- t(values - mean(values))
pc <- data.frame(princomp(values)$scores[,1:2], z = colData(x)$perla)
names(pc) <- c("x","y","z")
ggplot(pc, aes(x,y))+geom_point()
pc <- data.frame(reducedDim(x)[,1:2], z = colData(x)$perla)
names(pc) <- c("x","y","z")
ggplot(pc, aes(x,y,col = z))+geom_point()
pc <- data.frame(reducedDim(x)[,1:3], z = colData(x)$perla)
pairs(pc[,-4])
ggplot(pc, aes(x,y,col = z))+geom_point()+
scale_color_viridis_c()
pc <- data.frame(reducedDim(x)[,1:2], z = colData(x)$perla)
names(pc) <- c("x","y","z")
ggplot(pc, aes(x,y,col = z))+geom_point()+
scale_color_viridis_c()
pc$z
pc <- data.frame(reducedDim(x)[,1:2], z = colData(x)$perla)
names(pc) <- c("x","y","z")
ggplot(pc, aes(x,y,col = z))+geom_point()+
scale_color_viridis_c()
ggplot(pc, aes(x,y,col = z))+geom_point()+
scale_colour_viridis_d()
ggplot(pc, aes(x,y,col = z))+geom_point(cex ? 3)+
scale_colour_viridis_d()
ggplot(pc, aes(x,y,col = z))+geom_point(cex = 3)+
scale_colour_viridis_d()
ggplot(pc, aes(x,y,col = z))+geom_point(cex = 3)+
scale_colour_viridis_d()+
theme(text = element_text(size = 18))
ggplot(pc, aes(x,y,col = z))+geom_point(cex = 3)+
scale_colour_viridis_d()+theme_bw()
ggplot(pc, aes(x,y,col = z))+geom_point(cex = 3)+
scale_colour_viridis_d()+theme_classic()
cite("BayesSpace")
citation("BayesSpace")
install.packages("~/perla_to_mouse_brain/Results/TRIFASE_0.0.2.tar.gz", repos = NULL, type = "source")
install.packages("Rfast")
install.packages("~/perla_to_mouse_brain/Results/TRIFASE_0.0.2.tar.gz", repos = NULL, type = "source")
